<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>éœ“è™¹éŸ³ä¹æ’­æ”¾å™¨</title>
  <style>
    body {
      background: #0a0a0a;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #00ffe0;
      font-size: 2rem;
      margin-bottom: 20px;
      text-shadow: 0 0 10px #00ffe088;
    }

    .song-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .song-card {
      background: linear-gradient(135deg, #111, #1a1a1a);
      border-radius: 20px;
      padding: 15px;
      box-shadow: 0 0 20px #00ffe022;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: transform 0.3s;
    }

    .song-card:hover {
      transform: scale(1.02);
    }

    .cover {
      width: 60px;
      height: 60px;
      border-radius: 15px;
      object-fit: cover;
      box-shadow: 0 0 12px #00ffe088;
    }

    .info {
      flex: 1;
    }

    .title {
      font-size: 1rem;
      font-weight: bold;
      margin-bottom: 10px;
      color: #00ffe0;
      text-shadow: 0 0 6px #00ffe055;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .play-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      background: radial-gradient(circle, #00ffe0 0%, #00ccaa 100%);
      box-shadow: 0 0 10px #00ffe099, 0 0 30px #00ffe044;
      color: #000;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }

    .play-btn:hover {
      transform: scale(1.15);
      background: radial-gradient(circle, #00ffff 0%, #00ccff 100%);
    }

    .progress {
      flex: 1;
      height: 6px;
      background: #333;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #00ffe0, #00ccff);
      width: 0%;
      transition: width 0.1s linear;
      box-shadow: 0 0 8px #00ffe088;
    }

    .loading {
      text-align: center;
      color: #aaa;
      padding: 30px;
    }
  </style>
</head>
<body>
  <h1>ğŸ¶ éœ“è™¹éŸ³ä¹æ’­æ”¾å™¨</h1>
  <div id="musicList" class="song-list">
    <div class="loading">åŠ è½½ä¸­...</div>
  </div>

  <script>
    const repo = 'rjdsq/rjdsq.github.io';
    const path = 'music';
    const proxy = 'https://gh-proxy.com/';
    const musicListEl = document.getElementById('musicList');

    const allAudios = [];

    function formatName(name) {
      return decodeURIComponent(name).replace(/\.(mp3|ogg|wav)$/i, '');
    }

    async function fetchMusicFiles() {
      const res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`);
      const files = await res.json();
      return files.filter(file => /\.(mp3|ogg|wav)$/i.test(file.name));
    }

    async function createMusicCard(file) {
      const title = formatName(file.name);
      const audioUrl = proxy + file.download_url;
      const coverUrl = 'https://www.dmoe.cc/random.php?' + Math.random();

      const card = document.createElement('div');
      card.className = 'song-card';

      const cover = document.createElement('img');
      cover.className = 'cover';
      cover.src = coverUrl;

      const info = document.createElement('div');
      info.className = 'info';

      const titleEl = document.createElement('div');
      titleEl.className = 'title';
      titleEl.textContent = title;

      const controls = document.createElement('div');
      controls.className = 'controls';

      const playBtn = document.createElement('button');
      playBtn.className = 'play-btn';
      playBtn.textContent = 'â–¶';

      const progress = document.createElement('div');
      progress.className = 'progress';
      const progressBar = document.createElement('div');
      progressBar.className = 'progress-bar';
      progress.appendChild(progressBar);

      controls.appendChild(playBtn);
      controls.appendChild(progress);

      info.appendChild(titleEl);
      info.appendChild(controls);

      const audio = new Audio(audioUrl);
      audio.preload = 'metadata';

      playBtn.addEventListener('click', () => {
        if (audio.paused) {
          // Pause others
          allAudios.forEach(({ audio: a, btn }) => {
            if (a !== audio) {
              a.pause();
              btn.textContent = 'â–¶';
            }
          });
          audio.play();
          playBtn.textContent = 'â¸';
        } else {
          audio.pause();
          playBtn.textContent = 'â–¶';
        }
      });

      audio.addEventListener('ended', () => {
        playBtn.textContent = 'â–¶';
      });

      audio.addEventListener('timeupdate', () => {
        if (audio.duration) {
          const percent = (audio.currentTime / audio.duration) * 100;
          progressBar.style.width = percent + '%';
        }
      });

      allAudios.push({ audio, btn: playBtn });

      card.appendChild(cover);
      card.appendChild(info);
      return card;
    }

    async function init() {
      try {
        const files = await fetchMusicFiles();
        musicListEl.innerHTML = '';
        for (const file of files) {
          const card = await createMusicCard(file);
          musicListEl.appendChild(card);
        }
      } catch (e) {
        musicListEl.innerHTML = '<div class="loading">åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ GitHub API æˆ–ç½‘ç»œé—®é¢˜</div>';
        console.error(e);
      }
    }

    init();
  </script>
</body>
</html>